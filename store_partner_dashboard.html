<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Partner Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
    <div class="container my-4 p-4 bg-white rounded-3 shadow-lg">
        <h2 class="mb-4 text-primary"><i class="bi bi-shop-fill me-2"></i>Your Store Inventory</h2>
        <p class="lead text-muted mb-4">Track your current stock, recent sales, and upcoming deliveries from Arivu Foods.</p>

        <div class="mb-3">
            <label for="selectStore" class="form-label fw-bold">Select Your Store:</label>
            <select class="form-select w-auto" id="selectStore">
                <option value="">Loading Stores...</option>
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>

        <div id="dashboardContent" class="d-none">
            <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                <!-- Current Stock Card -->
                <div class="col">
                    <div class="card h-100 shadow-sm border-0 rounded-4 text-center">
                        <div class="card-body">
                            <i class="bi bi-clipboard-check-fill text-primary display-4 mb-3"></i>
                            <h5 class="card-title text-primary">Current Stock (Units)</h5>
                            <p class="card-text fs-2 fw-bold" id="storeCurrentStock">--</p>
                            <small class="text-muted">Total units of Arivu Foods products</small>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a href="#" data-page="current-stock" class="btn btn-outline-primary rounded-pill">View All Stock</a>
                        </div>
                    </div>
                </div>
                <!-- Units Sold Today Card -->
                <div class="col">
                    <div class="card h-100 shadow-sm border-0 rounded-4 text-center">
                        <div class="card-body">
                            <i class="bi bi-currency-dollar text-success display-4 mb-3"></i>
                            <h5 class="card-title text-success">Units Sold (Today)</h5>
                            <p class="card-text fs-2 fw-bold" id="storeSalesToday">--</p>
                            <small class="text-muted">Products sold from your store today</small>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a href="#" data-page="record-sale" class="btn btn-outline-success rounded-pill">Record a Sale</a>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="mb-3 text-secondary"><i class="bi bi-list-columns-reverse me-2"></i>Your Products In Stock</h3>
            <div id="storeProductsTableContainer" class="table-responsive">
                <div class="text-center p-5">
                    <div class="spinner-border text-secondary" role="status">
                        <span class="visually-hidden">Loading products in stock...</span>
                    </div>
                </div>
            </div>
            <small class="text-muted mt-2">Detailed list of Arivu Foods products currently at your store.</small>

            <h3 class="mb-3 mt-5 text-secondary"><i class="bi bi-truck-flatbed me-2"></i>Upcoming Deliveries</h3>
            <div id="upcomingDeliveriesTableContainer" class="table-responsive">
                <div class="text-center p-5">
                    <div class="spinner-border text-secondary" role="status">
                        <span class="visually-hidden">Loading upcoming deliveries...</span>
                    </div>
                </div>
            </div>
            <small class="text-muted mt-2">Dispatches from Arivu Foods destined for your store.</small>
        </div>

    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Custom JavaScript for this page (would be handled by main.js/components.js) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Store Partner Dashboard loaded.");

            async function loadStoreDashboard(storeId) {
                document.getElementById('dashboardContent').classList.remove('d-none');
                const resp = await fetch(`http://localhost:8000/dashboard/store/${storeId}`);
                const data = await resp.json();
                document.getElementById('storeCurrentStock').textContent = data.current_stock;
                document.getElementById('storeSalesToday').textContent = data.sales_today;
            }

            async function populateStoreDropdown() {
                try {
                    const resp = await fetch('http://localhost:8000/locations');
                    const locations = await resp.json();
                    const retailStores = locations.filter(loc => loc.location_type === 'Retail Store');
                    const selectStoreDropdown = document.getElementById('selectStore');
                    selectStoreDropdown.innerHTML = '<option value="">Select Your Store</option>';
                    retailStores.forEach(store => {
                        const option = document.createElement('option');
                        option.value = store.location_id;
                        option.textContent = store.location_name;
                        selectStoreDropdown.appendChild(option);
                    });

                    selectStoreDropdown.addEventListener('change', async (event) => {
                        const selectedStoreId = event.target.value;
                        if (selectedStoreId) {
                            await loadStoreDashboard(selectedStoreId);
                        } else {
                            document.getElementById('dashboardContent').classList.add('d-none');
                        }
                    });
                } catch (error) {
                    console.error('Failed to load stores for dropdown:', error);
                    document.getElementById('selectStore').innerHTML = '<option value="">Error loading stores</option>';
                }
            }

            populateStoreDropdown();
        });
    </script>
</body>
</html>
